version: "2.1"
orbs:
  eb: circleci/aws-elastic-beanstalk@1.0.0
  node: circleci/node@5.1.0
  python: circleci/python@2.1.1

jobs:
  # say_hello:
  #   executor: python/default
  #   steps:
  #     - run: echo "Hello world!"
  build_flask_app:
    description: "Setup Flask App"
    executor: python/default
    steps:
      - checkout
      - python/install-packages:
          pip-dependency-file: requirements.txt
          pkg-manager: pip

  build_vite_app:
    executor: node/default
    working_directory: ~/client
    steps:
      - checkout
      - run: cd client/
      - node/install-packages:
          cache-path: ~/client/node_modules
          override-ci-command: npm install
      - run: npm run build
workflows:
  main:
    jobs:
      # - build_flask_app
      # - eb/deploy:
      #     context: aws-credentials
      #     environment-name: MeowAI
      #     platform-version: python-3.7
      #     filters:
      #       branches:
      #         only:
      #           - flask_eb
      #     label: version-<<pipeline.number>>
      #     requires:
      #       - build_flask_app
      - build_vite_app
      # - eb/deploy:
      #     context: aws-credentials
      #     environment-name: MeowAI-Page
      #     platform-version: php-8.1
      #     filters:
      #       branches:
      #         only:
      #           - flask_eb
      #     label: version-<<pipeline.number>>
      #     requires:
      #       - build_vite_app
